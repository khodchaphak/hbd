<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>5-layer Birthday Cake</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="balloon-container"></div>
  <canvas id="firework-canvas" style="position:fixed;left:0;top:0;width:100vw;height:100vh;pointer-events:none;z-index:101;"></canvas>
  <audio id="hbd-audio" src="hbd.mp3" loop></audio>

  <script>
    // เล่นเสียงเมื่อผู้ใช้คลิกที่หน้าเว็บครั้งแรก
    let hbdPlayed = false;
    window.addEventListener('click', function playHbdOnce() {
      if (!hbdPlayed) {
        document.getElementById('hbd-audio').play();
        hbdPlayed = true;
      }
    });
  </script>
  <div class="wrapper">
    <div class="cake">
      <div class="layer layer1"></div>
      <div class="layer layer2"></div>
      <div class="layer layer3"></div>
      <div class="layer layer4"></div>
      <div class="layer layer5"></div>
      <div class="candle">
        <div class="flame"></div>
      </div>
    </div>
    <div class="plate"></div>
    <div class="text">
      Happy Birthday!<br>
  <span>N'Gram</span>
    </div>
  </div>
</body>
  <script>
    // Balloon animation logic (run after DOM loaded)
    window.addEventListener('DOMContentLoaded', function() {
      // Firework logic
      const fireworkCanvas = document.getElementById('firework-canvas');
      const ctx = fireworkCanvas.getContext('2d');
      function resizeCanvas() {
        fireworkCanvas.width = window.innerWidth;
        fireworkCanvas.height = window.innerHeight;
      }
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);

      function firework(x, y, color) {
        const particles = [];
        const count = 18 + Math.floor(Math.random() * 8);
        for (let i = 0; i < count; i++) {
          const angle = (Math.PI * 2 * i) / count;
          const speed = 2 + Math.random() * 2;
          particles.push({
            x, y,
            vx: Math.cos(angle) * speed,
            vy: Math.sin(angle) * speed,
            alpha: 1,
            color,
          });
        }
        let frame = 0;
        function animate() {
          ctx.clearRect(0, 0, fireworkCanvas.width, fireworkCanvas.height);
          let alive = false;
          for (const p of particles) {
            if (p.alpha > 0.05) {
              alive = true;
              ctx.save();
              ctx.globalAlpha = p.alpha;
              ctx.beginPath();
              ctx.arc(p.x, p.y, 4, 0, 2 * Math.PI);
              ctx.fillStyle = p.color;
              ctx.shadowColor = p.color;
              ctx.shadowBlur = 16;
              ctx.fill();
              ctx.restore();
              p.x += p.vx;
              p.y += p.vy;
              p.vy += 0.04; // gravity
              p.alpha *= 0.96;
            }
          }
          if (alive && frame < 60) {
            requestAnimationFrame(animate);
            frame++;
          } else {
            ctx.clearRect(0, 0, fireworkCanvas.width, fireworkCanvas.height);
          }
        }
        animate();
      }

      function randomFirework() {
        const x = Math.random() * window.innerWidth * 0.8 + window.innerWidth * 0.1;
        const y = Math.random() * window.innerHeight * 0.3 + window.innerHeight * 0.1;
        firework(x, y, randomPastel());
        setTimeout(randomFirework, Math.random() * 2000 + 1200);
      }
      setTimeout(randomFirework, 1200);
      const balloonContainer = document.querySelector('.balloon-container');
      function random(min, max) { return Math.random() * (max - min) + min; }
      function randomPastel() {
        // hue 0-360, s 60-80%, l 75-90%
        const h = Math.floor(random(0, 360));
        const s = Math.floor(random(60, 80));
        const l = Math.floor(random(75, 90));
        return `hsl(${h},${s}%,${l}%)`;
      }
      function createBalloon() {
        const balloon = document.createElement('div');
        balloon.className = 'balloon';
        balloon.style.background = randomPastel();
        const left = random(5, 95);
        balloon.style.left = left + 'vw';
        balloon.style.bottom = '-60px';
        balloon.style.opacity = random(0.7, 1);
        balloon.style.zIndex = 100;
        // Add string
        const string = document.createElement('div');
        string.className = 'balloon-string';
        balloon.appendChild(string);
        balloonContainer.appendChild(balloon);
        // Animate
        const duration = random(6, 12);
        const drift = random(-30, 30);
        balloon.animate([
          { transform: `translateX(0px) translateY(0px)` },
          { transform: `translateX(${drift}px) translateY(-90vh)` }
        ], {
          duration: duration * 1000,
          easing: 'cubic-bezier(.4,0,.2,1)'
        });
        setTimeout(() => {
          balloon.remove();
          setTimeout(createBalloon, random(0.5, 2) * 1000);
        }, duration * 1000);
      }
      // สร้างลูกโป่งเริ่มต้น 4-7 ลูก
      for (let i = 0; i < Math.floor(random(4, 7)); i++) {
        setTimeout(createBalloon, i * 800);
      }
    });
  </script>
</html>
